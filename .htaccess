# Apache .htaccess Configuration
# Protezione dei file sensibili

# Abilita il motore di riscrittura
<IfModule mod_rewrite.c>
    RewriteEngine On
</IfModule>

# Proteggi il file di configurazione con le chiavi API
# (config.example.js è accessibile perché è solo un template)
<FilesMatch "^config\.js$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Proteggi il file di dati JSON
<FilesMatch "^data\.json$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Proteggi i file di backup
<FilesMatch "\.(backup|bak|tmp|swp)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Proteggi i file nascosti (come .git, .gitignore, etc)
<FilesMatch "^\.">
    Order Allow,Deny
    Deny from all
    # Permetti l'accesso a .well-known (necessario per certificati SSL)
    <FilesMatch "^\.well-known">
        Order Allow,Deny
        Allow from all
    </FilesMatch>
</FilesMatch>

# Previeni la visualizzazione delle directory
Options -Indexes

# Proteggi contro attacchi di injection
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
    RewriteRule ^(.*)$ index.html [F,L]
</IfModule>

# Forza HTTPS (decommentare se si utilizza SSL)
# <IfModule mod_rewrite.c>
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>

# Imposta header di sicurezza
<IfModule mod_headers.c>
    # Previeni clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Previeni MIME sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Abilita protezione XSS nei browser
    Header set X-XSS-Protection "1; mode=block"
    
    # Content Security Policy (personalizza in base alle tue esigenze)
    # Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"
</IfModule>

# Impostazioni PHP di sicurezza
<IfModule mod_php.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_flag expose_php Off
</IfModule>
