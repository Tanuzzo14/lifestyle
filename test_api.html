<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Lifestyle Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Test API - Lifestyle Designer</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-xl font-bold mb-4">1. Test Scrittura Dati</h2>
            <button onclick="testWrite()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Scrivi Dati Test
            </button>
            <div id="writeResult" class="mt-4 p-4 bg-gray-50 rounded"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-xl font-bold mb-4">2. Test Lettura Dati</h2>
            <button onclick="testRead()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Leggi Dati Test
            </button>
            <div id="readResult" class="mt-4 p-4 bg-gray-50 rounded"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-xl font-bold mb-4">3. Test Lettura Tutti i Dati</h2>
            <button onclick="testReadAll()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                Leggi Tutti i Dati
            </button>
            <div id="readAllResult" class="mt-4 p-4 bg-gray-50 rounded overflow-auto max-h-96"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">4. Test Eliminazione Dati</h2>
            <button onclick="testDelete()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                Elimina Dati Test
            </button>
            <div id="deleteResult" class="mt-4 p-4 bg-gray-50 rounded"></div>
        </div>
    </div>

    <script>
        const API_URL = 'api.php';
        const TEST_USER_ID = 'test_user_' + Date.now();

        async function apiCall(method, params = {}) {
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                
                if (method === 'GET') {
                    const query = new URLSearchParams(params).toString();
                    const response = await fetch(`${API_URL}?${query}`, options);
                    return await response.json();
                } else {
                    options.body = JSON.stringify(params);
                    const response = await fetch(API_URL, options);
                    return await response.json();
                }
            } catch (error) {
                console.error('Errore API:', error);
                return { success: false, error: error.message };
            }
        }

        async function testWrite() {
            const resultDiv = document.getElementById('writeResult');
            resultDiv.innerHTML = '<p class="text-gray-500">Scrivendo dati...</p>';
            
            const testData = {
                userType: 'user',
                displayUsername: 'TEST_USER',
                passwordHash: '12345',
                data: {
                    habits: [
                        { id: 1, description: 'TEST HABIT 1', completed: false },
                        { id: 2, description: 'TEST HABIT 2', completed: true }
                    ],
                    workout: [
                        { id: 1, day: 'LUNEDI', exercise: 'SQUAT', sets: 3, reps: 10, load: '100KG' }
                    ],
                    diet: [],
                    dietPlan: { targetCalories: 2000, plan: [] },
                    measurementsLog: [],
                    dailyCompliance: {}
                },
                createdAt: new Date().toISOString()
            };

            const result = await apiCall('POST', { userId: TEST_USER_ID, data: testData });
            
            if (result.success) {
                resultDiv.innerHTML = `
                    <p class="text-green-600 font-bold">✓ Successo!</p>
                    <p class="text-sm text-gray-600 mt-2">User ID: ${TEST_USER_ID}</p>
                    <pre class="mt-2 text-xs overflow-auto">${JSON.stringify(result, null, 2)}</pre>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p class="text-red-600 font-bold">✗ Errore!</p>
                    <pre class="mt-2 text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            }
        }

        async function testRead() {
            const resultDiv = document.getElementById('readResult');
            resultDiv.innerHTML = '<p class="text-gray-500">Leggendo dati...</p>';
            
            const result = await apiCall('GET', { userId: TEST_USER_ID });
            
            if (result.success) {
                resultDiv.innerHTML = `
                    <p class="text-green-600 font-bold">✓ Dati letti con successo!</p>
                    <pre class="mt-2 text-xs overflow-auto max-h-96">${JSON.stringify(result.data, null, 2)}</pre>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p class="text-red-600 font-bold">✗ Errore!</p>
                    <pre class="mt-2 text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            }
        }

        async function testReadAll() {
            const resultDiv = document.getElementById('readAllResult');
            resultDiv.innerHTML = '<p class="text-gray-500">Leggendo tutti i dati...</p>';
            
            const result = await apiCall('GET', {});
            
            if (result.success) {
                const userCount = Object.keys(result.data || {}).length;
                resultDiv.innerHTML = `
                    <p class="text-green-600 font-bold">✓ Trovati ${userCount} utenti nel database</p>
                    <pre class="mt-2 text-xs overflow-auto">${JSON.stringify(result.data, null, 2)}</pre>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p class="text-red-600 font-bold">✗ Errore!</p>
                    <pre class="mt-2 text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            }
        }

        async function testDelete() {
            const resultDiv = document.getElementById('deleteResult');
            resultDiv.innerHTML = '<p class="text-gray-500">Eliminando dati...</p>';
            
            const result = await apiCall('DELETE', { userId: TEST_USER_ID });
            
            if (result.success) {
                resultDiv.innerHTML = `
                    <p class="text-green-600 font-bold">✓ Dati eliminati con successo!</p>
                    <pre class="mt-2 text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p class="text-red-600 font-bold">✗ Errore!</p>
                    <pre class="mt-2 text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            }
        }

        // Mostra il Test User ID corrente
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Test User ID:', TEST_USER_ID);
        });
    </script>
</body>
</html>
