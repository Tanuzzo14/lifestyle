<!DOCTYPE html>
<html>
<head>
    <title>Test Gemini API Integration</title>
</head>
<body>
    <h1>Test Gemini API Integration</h1>
    <button onclick="testGeminiWorkout()">Test Workout Standardization</button>
    <button onclick="testGeminiDiet()">Test Diet Standardization</button>
    <pre id="output"></pre>

    <script src="config.js"></script>
    <script>
        async function testGeminiWorkout() {
            const output = document.getElementById('output');
            output.textContent = 'Testing workout standardization with Gemini...\n';
            
            const testWorkout = `GIORNO A
PANCA PIANA - 3 SERIE - 10 REPS - 60KG
SQUAT - 4 SERIE - 8 REPS - 80KG`;
            
            const prompt = `You are a helpful assistant that converts workout plans to a standardized JSON format.
The output must be a JSON array where each object has these fields:
- day: string (e.g., "GIORNO A", "LUNEDÌ", "DAY 1")
- exercise: string (name of the exercise)
- sets: number (number of sets, default to 0 if not specified)
- reps: number (number of reps, default to 0 if not specified)
- load: string (weight/load, default to "N/D" if not specified)

Convert any workout plan format (text, CSV, table, etc.) to this JSON format. All text values should be in UPPERCASE.

Here is the workout plan to convert:
${testWorkout}`;

            try {
                const response = await fetch(GEMINI_PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: prompt
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Gemini API error: ${response.status}`);
                }

                const data = await response.json();
                output.textContent += '\nGemini API Response:\n' + JSON.stringify(data, null, 2);
                
                const content = data.candidates[0].content.parts[0].text;
                output.textContent += '\n\nExtracted Content:\n' + content;
                
                // Extract JSON from response
                let jsonText = content;
                if (content.includes('```json')) {
                    jsonText = content.match(/```json\n([\s\S]*?)\n```/)[1];
                } else if (content.includes('```')) {
                    jsonText = content.match(/```\n([\s\S]*?)\n```/)[1];
                }
                
                const parsed = JSON.parse(jsonText);
                output.textContent += '\n\nParsed JSON:\n' + JSON.stringify(parsed, null, 2);
                output.textContent += '\n\n✅ SUCCESS! Workout standardization works correctly!';
            } catch (error) {
                output.textContent += '\n\n❌ ERROR: ' + error.message;
                console.error('Error:', error);
            }
        }

        async function testGeminiDiet() {
            const output = document.getElementById('output');
            output.textContent = 'Testing diet standardization with Gemini...\n';
            
            const testDiet = `LUNEDÌ, COLAZIONE, UOVA E PANE, 200G, RICETTA, 450
LUNEDÌ, PRANZO, POLLO E RISO, 350G, RICETTA, 600`;
            
            const prompt = `You are a helpful assistant that converts diet plans to a standardized JSON format.
The output must be a JSON array where each object represents a day with these fields:
- day: string (e.g., "LUNEDÌ", "MARTEDÌ", etc. - must be one of: LUNEDÌ, MARTEDÌ, MERCOLEDÌ, GIOVEDÌ, VENERDÌ, SABATO, DOMENICA)
- meals: array of meal objects, each with:
  - category: string (meal type, e.g., "COLAZIONE", "PRANZO", "CENA", "SPUNTINO")
  - description: string (food description)
  - weight: string (portion size, e.g., "150G", "200ML")
  - type: string (food type/category, e.g., "RICETTA", "INTEGRATORE", "PROTEINA")
  - calories: number (calories for this meal)

Convert any diet plan format (text, CSV, table, etc.) to this JSON format. All text values should be in UPPERCASE.

Here is the diet plan to convert:
${testDiet}`;

            try {
                const response = await fetch(GEMINI_PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: prompt
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Gemini API error: ${response.status}`);
                }

                const data = await response.json();
                output.textContent += '\nGemini API Response:\n' + JSON.stringify(data, null, 2);
                
                const content = data.candidates[0].content.parts[0].text;
                output.textContent += '\n\nExtracted Content:\n' + content;
                
                // Extract JSON from response
                let jsonText = content;
                if (content.includes('```json')) {
                    jsonText = content.match(/```json\n([\s\S]*?)\n```/)[1];
                } else if (content.includes('```')) {
                    jsonText = content.match(/```\n([\s\S]*?)\n```/)[1];
                }
                
                const parsed = JSON.parse(jsonText);
                output.textContent += '\n\nParsed JSON:\n' + JSON.stringify(parsed, null, 2);
                output.textContent += '\n\n✅ SUCCESS! Diet standardization works correctly!';
            } catch (error) {
                output.textContent += '\n\n❌ ERROR: ' + error.message;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>
